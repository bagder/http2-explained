# 2. HTTP сегодня

HTTP 1.1 стал протоколом, который используется  поистине для всего в Интернете.
Огромные инвестиции были вложены в протоколы и инфраструктуру, которые теперь
извлекают из этого прибыль. Дошло до того, что  сегодня зачастую проще
запустить что-либо поверх HTTP, чем создавать что-то новое вместо него.

## 2.1. HTTP 1.1 огромен

Когда HTTP был создан и выпущен в мир, он, вероятно, воспринимался скорее как
простой и прямолинейный протокол, но время показало, что это не так.  HTTP 1.0
в RFC 1945 – это 60 страниц спецификации, выпущенной в 1996.  RFC 2616, который
описывал HTTP 1.1, был выпущен лишь тремя годами позднее в 1999 и значительно
разросся до 176 страниц. Кроме того, когда мы в IETF работали над обновлением
спецификации, она была разбита на шесть документов с ещё большим числом страниц
в итоге (что вылилось в RFC 7230 и прочие связанные спецификации). Без
сомнений, HTTP 1.1 большой и включает мириады деталей, тонкостей и в не меньшей
степени опциональных разделов.

## 2.2. Мир опций

Природа HTTP 1.1, заключённая в наличии большого числа мелких деталей и опций,
доступных для последующего изменения, вырастила экосистему программ, где нет ни
одной реализации, которая бы воплотила всё – и, на самом деле, невозможно точно
сказать, что представляет из себя это «всё». Что привело к ситуации, когда
возможности, которые первоначально мало использовались появлялись лишь в
небольшом числе реализаций, и те кто их реализовывал после наблюдали
незначительное их использование.

Позже это вызывало проблемы в совместимости, когда клиенты и сервера начали
активнее использовать подобные возможности. Конвейерная обработка HTTP (HTTP
pipelining) – это один из показательных примеров подобных возможностей.

## 2.3. Неполноценное использование TCP

HTTP 1.1 прошёл трудный путь, чтобы по настоящему воспользоваться всей мощью и
производительностью, которую даёт TCP. HTTP-клиенты и браузеры должны быть
по-настоящему изобретательными, чтобы найти способы для уменьшения времени
загрузки страницы.

Прочие эксперименты, которые параллельно велись в течении многих лет, также
подтверждали, что TCP не так просто заменить, и поэтому мы продолжаем работать
над улучшением как TCP, так и протоколов, работающих поверх него.

TCP можно легко начать использовать полноценно, чтобы избежать пауз или
периодов времени, которые могли быть использованы для отправки или приёма
большего количества данных. Последующие главы осветят некоторые из этих
недостатков использования.

## 2.4. Размер передачи и число объектов

Когда смотришь на тенденции развития некоторых наиболее популярных на сегодня
сайтов и сравниваешь сколько занимает времени загрузка их главной страницы,
просматривается явная закономерность. В последние годы количество данных,
которые требуется передать, постепенно выросло до отметки 1,9Мб и выше, но, что
наиболее важно в этом контексте, в среднем требуется загрузить сотню отдельных
ресурсов, чтобы  отобразить каждую страницу.

Как показывает график, тренд был растущим, но позднее нет никаких признаков,
что он будет дальше меняться. Он показывает рост суммарного размера передачи
(зелёным) и суммарного числа запросов (красным), используемых в среднем для
обслуживания наиболее популярных сайтов в мире и как оно изменилось за
последние четыре года.

![transfer size growth](https://raw.githubusercontent.com/bagder/http2-explained/master/images/transfer-size-growth.png)

## 2.5. Задержка убивает

<img style="float: right;" src="https://raw.githubusercontent.com/bagder/http2-explained/master/images/page-load-time-rtt-decreases.png" />

HTTP 1.1 очень чувствителен к задержкам, частично из-за того, что в конвейерной
передаче HTTP по-прежнему хватает проблем и она отключена у подавляющего числа
пользователей.

В то время, как все мы наблюдали значительное увеличение доступной пропускной
полосы у пользователей за последние несколько лет, мы не видели подобного
уровня снижения задержки. Каналы с высокой задержкой, как у многих современных
мобильных технологий, значительно снижают ощущение хорошей и быстрой
веб-навигации, даже если у вас имеется действительно широкополсное подключение.

Другой пример, когда действительно требуется низкая задержка, это некоторые
виды видео, такие как видео-конференция, игры и подобное, где требуется
передать не только заранее созданный поток.

## 2.6. Блокировка начала очереди

Конвейерная передача HTTP – это способ отправки очередного запроса,  при
ожидании ответа на предыдущий запрос. Это похоже на очередь к кассиру в банке
или супермаркете. Вы не знаете, что за люди перед вами: быстрые клиенты или
надоедливые персоны, которым потребуется бесконечное время, чтобы завершить
обслуживание – блокировка начала очереди.

<img style="float: right;" src="https://raw.githubusercontent.com/bagder/http2-explained/master/images/head-of-line-blocking.jpg" />

Безусловно вы можете тщательно выбирать очередь и в итоге выбрать ту, которую
посчитаете правильной, а иногда вы можете создать свою собственную очередь, но,
в  конце концов, вы не сможете избежать принятия решения и однажды выбрав
очередь, вы не можете её сменить.

Создание новой очереди связано с производительностью и расплатой ресурсами, и
не может масштабироваться за пределы небольшого числа очередей. Для этой задачи
нет идеального решения.

Даже сегодня, в 2015 году, большинство веб-браузеров на десктопах поставляются
с отключенным конвейером HTTP по умолчанию.

Дополнительные сведения по этой проблеме могут быть найдены в [баг-трекере
Firefox под номером
2643541](https://bugzilla.mozilla.org/show_bug.cgi?id=264354).
